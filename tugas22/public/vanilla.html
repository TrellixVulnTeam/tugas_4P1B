<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://momentjs.com/downloads/moment.js"></script>
    <title>Document</title>

    <style>
        .relative {
            position: relative;
            left: 80px;
        }

        ul {
            height: 50px;
            padding: 0px 5px;
            width: auto;
            float: right;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        ul li {
            list-style: none;
            padding: 5px 10px;
            font-weight: bold;
            border: 1px solid #ccc;
        }
    </style>
</head>

<body>
    <form id="search-user">
        <div class="container">
            <div class="card">
                <div class="card-header">
                    <h1>Daftar User</h1>
                </div>
                <div class="card-body"
                    style="background-image: url(https://img.freepik.com/free-vector/elegant-white-background-with-shiny-lines_1017-17580.jpg?w=2000)">
                    <div class="container">
                        <form class="row g-3">
                            <div class="col-md-10 relative">
                                <label for="strings" class="form-label">Nama</label>
                                <input type="text" class="form-control" id="strings" name="strings"
                                    placeholder="Masukkan Nama Lengkap">
                            </div>
                            <div class="col-md-10 relative">
                                <label for="integers" class="form-label">Berat Badan</label>
                                <input type="number" class="form-control" id="integers" name="integers"
                                    placeholder="Masukkan Berat Badan">
                            </div>
                            <hr>
                            <div class="col-10 relative">
                                <label for="s-float" class="form-label">Tinggi</label>
                                <input type="number" class="form-control" id="s-float" step="any" name="s-float"
                                    placeholder="Tinggi Bandan">
                            </div>
                            <div class="col-10 relative">
                                <label for="s-date" class="form-label">Date</label>
                                <input class="form-select" type="date" name="start-date" id="start-date">
                                to
                                <input class="form-select" type="date" name="end-date" id="end-date">
                            </div>
                            <hr>
                            <div class="col-md-10 relative">
                                <label for="s-boolean" class="form-label">Sudah Menikah</label>
                                <select id="s-boolean" name="s-boolean" class="form-select">
                                    <option value="" disabled selected>Pilihan...</option>
                                    <option value="true">True</option>
                                    <option value="false">False</option>
                                </select>
                            </div>
                            <br>
                            <hr>
                            <div class="container">
                                <button type="submit" class=" btn btn-primary col-md-1 btn-sm">Search</button>
                                <input type="reset" class="btn btn-warning btn-sm" value="Reset">
                            </div>
                            <br>
                            <br>
                        </form>
                    </div>
                </div>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama</th>
                            <th>Berat badan</th>
                            <th>Tinggi</th>
                            <th>Date</th>
                            <th>Sudah Menikah</th>
                            <th>Ubah / Hapus</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
                <div class="col-6">
                    <nav aria-label="Page navigation" id="pagination">
                    </nav>
                </div>
            </div>
        </div>
    </form>
    </div>
    <br>
    <hr>
    <br>
    <form id="form-user">
        <input type="hidden" id="id" name="id" value="">
        <div class="container">
            <div class="card">
                <div class="card-header">
                    <h1>Form User</h1>
                </div>
                <div class="card-body"
                    style="background-image: url(https://img.freepik.com/free-vector/elegant-white-background-with-shiny-lines_1017-17580.jpg?w=2000)">
                    <form class="row g-3">
                        <div class="col-md-12">
                            <label for="string" class="form-label">Nama</label>
                            <input type="text" class="form-control" id="string" name="string"
                                placeholder="Masukkan Nama Lengkap" required>
                        </div>
                        <hr>
                        <div class="col-md-12">
                            <label for="integer" class="form-label">Berat Badan</label>
                            <input type="number" class="form-control" id="integer" name="integer"
                                placeholder="Berat Badan" required>
                        </div>
                        <hr>
                        <div class="col-12">
                            <label for="float" class="form-label">Tinggi</label>
                            <input type="number" class="form-control" id="float" step="any" name="float"
                                placeholder="Tinggi Bandan" required>
                        </div>
                        <hr>
                        <div class="col-12">
                            <label for="date" class="form-label">Date</label>
                            <input class="form-select" type="date" id="date" name="date" required>
                        </div>
                        <hr>
                        <div class="col-md-2">
                            <label for="boolean" class="form-label">Sudah Menikah</label>
                            <select id="boolean" name="boolean" class="form-select" required>
                                <option disabled selected>Pilihan...</option>
                                <option value="true">True</option>
                                <option value="false">False</option>
                            </select>
                        </div>
                        <br>
                        <hr>
                        <div class="card-footer">
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary btn-sm">Save</button>
                                <input type="reset" class="btn btn-warning btn-sm" value="Reset">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </form>
</body>

<script>

let params ={
        page : 1
    }
    const readData = () => {
        console.log('kebaca', params)
        fetch(`http://localhost:3000/users?${new URLSearchParams(params).toString()}`).then((response) => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            return response.json();

        }).then(({findResult, page, pages, offset}) => {
            let html = ''
            // console.log('ini data', data)
            findResult.forEach((item, index) => {

                html += `
                <tr>
                    <td>${(offset + index) + 1}</td>
                    <td>${item.string}</td>
                    <td>${item.integer}</td>
                    <td>${item.float}</td>
                    <td>${moment(item.date).format("DD  MMMM  YYYY")}</td>
                    <td>${item.boolean}</td>
                    <td>
                        <button type="button" class="btn btn-success btn-sm" onClick="editData('${item._id}')">edit</button>
                        <button type="button" class="btn btn-danger btn-sm" onClick="deleteData('${item._id}')">delete</button>
                    </td>
                </tr>
            `
            });
            document.querySelector('table tbody').innerHTML = html
            paginations(page, pages)
        });
    }
    const saveData = (id, string, integer, float, date, boolean) => {
        // console.log('ke save', string, integer, float, date, boolean)
        if (id) {
            fetch(`http://localhost:3000/users/${id}`, {

                method: 'PUT',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ string, integer, float, date, boolean })
            }).then((response) => {
                console.log('respon aja', response)
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                return response.json();

            }).then((data) => {
                // console.log('keupdate', data)
                readData()
                document.getElementById("form-user").reset()
                document.getElementById('id').value = ''
            }).catch(e => console.log(e))
        } else {
            fetch("http://localhost:3000/users", {

                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ string, integer, float, date, boolean })
            }).then((response) => {
                console.log('respon aja', response)
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                return response.json();

            }).then((data) => {
                console.log('data masuk', data)
                readData()
                document.getElementById("form-user").reset()
            })
        }
    }

    const editData = (id) => {
        fetch(`http://localhost:3000/users/${id}`, {

            method: 'GET',

            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
        }).then((response) => {
            // console.log('respon aja', response)
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
                console.log(response)
            }

            return response.json();

        }).then((data) => {
            document.getElementById('id').value = data._id
            document.getElementById('string').value = data.string
            document.getElementById('integer').value = data.integer
            document.getElementById('float').value = data.float
            document.getElementById('date').value = data.date
            document.getElementById('boolean').value = data.boolean
        })
    }


    const deleteData = (id) => {
        fetch(`http://localhost:3000/users/${id}`, {

            method: 'DELETE',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
        }).then((response) => {
            // console.log('respon aja', response)
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
                // console.log(response)
            }

            return response.json();

        }).then((data) => {
            readData()
        })
    }


    readData()

    document.getElementById('form-user').addEventListener('submit', function (event) {
        event.preventDefault()
        const id = document.getElementById('id').value
        const string = document.getElementById('string').value
        const integer = document.getElementById('integer').value
        const float = document.getElementById('float').value
        const date = document.getElementById('date').value
        const boolean = document.getElementById('boolean').value
        // console.log(string, integer, float, date, boolean)
        saveData(id, string, integer, float, date, boolean)
    })


    document.getElementById('search-user').addEventListener('submit', function (event) {
        event.preventDefault()
        const string = document.getElementById('strings').value
        const integer = document.getElementById('integers').value
        const float = document.getElementById('s-float').value
        const startDate = document.getElementById('start-date').value
        const endDate = document.getElementById('end-date').value
        const boolean = document.getElementById('s-boolean').value
        params = {...params, string, integer, float, startDate, endDate, boolean, page: 1}
        console.log(string, integer, float, startDate, endDate)
        readData()
    })


    const changePage = (page) => {
        console.log('ke eksekusi', page)
        params.page = page
        readData()
    }



   const paginations = (page, pages) =>
   {
        let html = `<ul class="pagination">
                               <li class="page-item ${page == 1 ? ' disabled' : ''}">
                                 <a class="page-link" href="javascript:void(0)" aria-label="Previous" onclick="changePage(${page -1})">
                                  <span aria-hidden="true">&laquo;</span>
            </a>
        </li>`
        for (let i = 1; i <= pages; i++) {
        html += `
        <li class="page-item ${i == page ? ' active' : ''}"><a class="page-link" href="javascript:void(0)" onclick="changePage(${i})">${i}</a></li>`
        }
        html += `<li class="page-item ${page == pages ? ' disabled' : ''}">
            <a class="page-link" href="javascript:void(0)" aria-label="Next" onclick="changePage(${page + 1})">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>`
    document.getElementById('pagination').innerHTML = html
    }

</script>

</html>