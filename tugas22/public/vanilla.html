<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://momentjs.com/downloads/moment.js"></script>
    <title>Document</title>
</head>

<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h1>Daftar User</h1>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama</th>
                            <th>Berat badan</th>
                            <th>Tinggi</th>
                            <th>Date</th>
                            <th>Sudah Menikah</th>
                            <th>Ubah / Hapus</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
            <div class="container">
                <button type="button" class=" btn btn-warning">Search</button>
            </div>
            <br>
        </div>
    </div>
    <br>
    <hr>
    <br>
    <form id="form-user">
        <input type="hidden" id="id" name="id" value="">
        <div class="container">
            <div class="card">
                <div class="card-header">
                    <h1>Form User</h1>
                </div>
                <div class="card-body" style="background-image: url(https://wallpapercave.com/wp/9PaZMV2.jpg)">
                    <form class="row g-3">
                        <div class="col-md-12">
                            <label for="string" class="form-label">Nama</label>
                            <input type="text" class="form-control" id="string" name="string"
                                placeholder="Masukkan Nama Lengkap" required>
                        </div>
                        <hr>
                        <div class="col-md-12">
                            <label for="integer" class="form-label">Berat Badan</label>
                            <input type="number" class="form-control" id="integer" name="integer"
                                placeholder="Berat Badan" required>
                        </div>
                        <hr>
                        <div class="col-12">
                            <label for="float" class="form-label">Tinggi</label>
                            <input type="number" class="form-control" id="float" step="any" name="float"
                                placeholder="Tinggi Bandan" required>
                        </div>
                        <hr>
                        <div>
                            DATE<input class="form-select" type="date" id="date" name="date" required>
                        </div>
                        <hr>
                        <div class="col-md-2">
                            <label for="boolean" class="form-label">Sudah Menikah</label>
                            <select id="boolean" name="boolean" class="form-select" required>
                                <option disabled selected>Pilihan...</option>
                                <option value="true">True</option>
                                <option value="false">False</option>
                            </select>
                        </div>
                        <br>
                        <hr>
                        <div class="card-footer"
                            style="background-image: url(https://i.pinimg.com/originals/b0/c6/e9/b0c6e965d8db234056f74cc2fa510d52.jpg)">
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary btn-sm">Save</button>
                                <input type="reset" class="btn btn-warning btn-sm" value="Reset">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </form>
</body>

<script>
    const readData = () => {
        console.log('kebaca')
        fetch("http://localhost:3000/users").then((response) => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            return response.json();

        }).then((data) => {
            let html = ''
            // console.log('ini data', data)
            data.forEach((item, index) => {

                html += `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.string}</td>
                    <td>${item.integer}</td>
                    <td>${item.float}</td>
                    <td>${moment(item.date).format("MMM DD YYYY")}</td>
                    <td>${item.boolean}</td>
                    <td>
                        <button type="button" class="btn btn-success btn-sm" onClick="editData('${item._id}')">edit</button>
                        <button type="button" class="btn btn-danger btn-sm" onClick="deleteData('${item._id}')">delete</button>
                    </td>
                </tr>
            `
            });
            document.querySelector('table tbody').innerHTML = html
        });
    }
    const saveData = (id, string, integer, float, date, boolean) => {
        console.log('ke save', id)
        if (id) {
            fetch(`http://localhost:3000/users/${id}`, {

                method: 'PUT',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({  string, integer, float, date, boolean })
            }).then((response) => {
                console.log('respon aja', response)
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                return response.json();

            }).then((data) => {
                console.log('keupdate', data)
                readData()
                document.getElementById("form-user").reset()
            }).catch(e => console.log(e))
        } else {
            fetch("http://localhost:3000/users", {

                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ string, integer, float, date, boolean })
            }).then((response) => {
                // console.log('respon aja', response)
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                return response.json();

            }).then((data) => {
                readData()
                document.getElementById("form-user").reset()
            })
        }
    }

    const editData = (id) => {
        fetch(`http://localhost:3000/users/${id}`, {

            method: 'GET',

            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
        }).then((response) => {
            // console.log('respon aja', response)
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
                console.log(response)
            }

            return response.json();

        }).then((data) => {
            document.getElementById('id').value = data._id
            document.getElementById('string').value = data.string
            document.getElementById('integer').value = data.integer
            document.getElementById('float').value = data.float
            document.getElementById('date').value = data.date
            document.getElementById('boolean').value = data.boolean
        })
    }


    const deleteData = (id) => {
        fetch(`http://localhost:3000/users/${id}`, {

            method: 'DELETE',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
        }).then((response) => {
            // console.log('respon aja', response)
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
                console.log(response)
            }

            return response.json();

        }).then((data) => {
            readData()
        })
    }


    readData()

    document.getElementById('form-user').addEventListener('submit', function (event) {
        event.preventDefault()
        const id = document.getElementById('id').value
        const string = document.getElementById('string').value
        const integer = document.getElementById('integer').value
        const float = document.getElementById('float').value
        const date = document.getElementById('date').value
        const boolean = document.getElementById('boolean').value
        // console.log(string, integer, float, date, boolean)
        saveData(id, string, integer, float, date, boolean)
    })

</script>

</html>