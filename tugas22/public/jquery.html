<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://momentjs.com/downloads/moment.js"></script>
    <script src="javascripts/jquery.js"></script>
    <title>Document</title>

    <style>
        .relative {
            position: relative;
            left: 80px;
        }
    </style>
</head>

<body>
    <form id="search-user">
        <div class="container">
            <div class="card">
                <div class="card-header">
                    <h1>Daftar User</h1>
                </div>
                <div class="card-body"
                    style="background-image: url(https://img.freepik.com/free-vector/elegant-white-background-with-shiny-lines_1017-17580.jpg?w=2000)">
                    <div class="container">
                        <form class="row g-3">
                            <div class="col-md-10 relative">
                                <label for="strings" class="form-label">Nama</label>
                                <input type="text" class="form-control" id="strings" name="strings"
                                    placeholder="Masukkan Nama Lengkap">
                            </div>
                            <div class="col-md-10 relative">
                                <label for="integers" class="form-label">Berat Badan</label>
                                <input type="number" class="form-control" id="integers" name="integers"
                                    placeholder="Masukkan Berat Badan">
                            </div>
                            <hr>
                            <div class="col-10 relative">
                                <label for="s-float" class="form-label">Tinggi</label>
                                <input type="number" class="form-control" id="s-float" step="any" name="s-float"
                                    placeholder="Tinggi Bandan">
                            </div>
                            <div class="col-10 relative">
                                <label for="s-date" class="form-label">Date</label>
                                <input class="form-select" type="date" name="start-date" id="start-date">
                                to
                                <input class="form-select" type="date" name="end-date" id="end-date">
                            </div>
                            <hr>
                            <div class="col-md-10 relative">
                                <label for="s-boolean" class="form-label">Sudah Menikah</label>
                                <select id="s-boolean" name="s-boolean" class="form-select">
                                    <option disabled selected>Pilihan...</option>
                                    <option value="true">True</option>
                                    <option value="false">False</option>
                                </select>
                            </div>
                            <br>
                            <hr>
                            <div class="container">
                                <button type="submit" class=" btn btn-primary col-md-1 btn-sm">Search</button>
                                <input type="reset" id="reset-search" class="btn btn-warning btn-sm" value="Reset">
                            </div>
                            <br>
                            <br>
                        </form>
                    </div>
                </div>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama</th>
                            <th>Berat badan</th>
                            <th>Tinggi</th>
                            <th>Date</th>
                            <th>Sudah Menikah</th>
                            <th>Ubah / Hapus</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
    </form>
    </div>
    <br>
    <hr>
    <br>
    <form id="form-user">
        <input type="hidden" id="id" name="id" value="">
        <div class="container">
            <div class="card">
                <div class="card-header">
                    <h1>Form User</h1>
                </div>
                <div class="card-body"
                    style="background-image: url(https://img.freepik.com/free-vector/elegant-white-background-with-shiny-lines_1017-17580.jpg?w=2000)">
                    <form class="row g-3">
                        <div class="col-md-12">
                            <label for="string" class="form-label">Nama</label>
                            <input type="text" class="form-control" id="string" name="string"
                                placeholder="Masukkan Nama Lengkap" required>
                        </div>
                        <hr>
                        <div class="col-md-12">
                            <label for="integer" class="form-label">Berat Badan</label>
                            <input type="number" class="form-control" id="integer" name="integer"
                                placeholder="Berat Badan" required>
                        </div>
                        <hr>
                        <div class="col-12">
                            <label for="float" class="form-label">Tinggi</label>
                            <input type="number" class="form-control" id="float" step="any" name="float"
                                placeholder="Tinggi Bandan" required>
                        </div>
                        <hr>
                        <div class="col-12">
                            <label for="date" class="form-label">Date</label>
                            <input class="form-select" type="date" id="date" name="date" required>
                        </div>
                        <hr>
                        <div class="col-md-2">
                            <label for="boolean" class="form-label">Sudah Menikah</label>
                            <select id="boolean" name="boolean" class="form-select" required>
                                <option disabled selected>Pilihan...</option>
                                <option value="true">True</option>
                                <option value="false">False</option>
                            </select>
                        </div>
                        <br>
                        <hr>
                        <div class="card-footer">
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary btn-sm">Save</button>
                                <input type="reset" id="reset-search-add" class="btn btn-warning btn-sm" value="Reset">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </form>
</body>

<script>
    const readData = (params) => {
        // console.log('kebaca', params)
        $.ajax({
            method: "GET",
            url: "http://localhost:3000/users",
            data: params,
            dataType: "json"
        }).done(function (data) {
            let html = ''
            // console.log('ini data', typeof data)
            data.forEach((item, index) => {

                html += `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.string}</td>
                    <td>${item.integer}</td>
                    <td>${item.float}</td>
                    <td>${moment(item.date).format("DD MMMM YYYY")}</td>
                    <td>${item.boolean}</td>
                    <td>
                        <button type="button" class="btn btn-success btn-sm btn-edit" iddata="${item._id}">edit</button>
                        <button type="button" class="btn btn-danger btn-sm btn-delete" iddatas="${item._id}">delete</button>
                    </td>
                </tr>
            `
            });
            $('table tbody').html(html)
        }).fail(function (err) {
            alert('gagal pake jquery')
        })
    }

    const saveData = (id, string, integer, float, date, boolean) => {
        // console.log('ke save', string, integer, float, date, boolean)
        if (id) {
            $.ajax({
                method: "PUT",
                url: `http://localhost:3000/users/${id}`,
                data: { string, integer, float, date, boolean },
                dataType: "json"
            }).done(function (data) {
                // console.log('keupdate', data)
                readData()
                $('#id').val('')

            }).catch(e => console.log(e))
        } else {
            $.ajax({
                method: "POST",
                url: `http://localhost:3000/users`,
                data: { string, integer, float, date, boolean },
                dataType: "json"
            }).done(function (data) {
                console.log('data masuk', data)
                readData()
                $("#form-user").reset()
            })
        }
    }

    const editData = (id) => {
        $.ajax({
            method: "GET",
            url: `http://localhost:3000/users/${id}`,
            dataType: "json"
        }).done(function (data) {
            $('#id').val(data._id)
            $('#string').val(data.string)
            $('#integer').val(data.integer)
            $('#float').val(data.float)
            $('#date').val(data.date)
            $('#boolean').val(data.boolean)
            // console.log(data.date)
            $("#form-user").reset()
        })
    }


    const deleteData = (id) => {
        $.ajax({
                method: "DELETE",
                url: `http://localhost:3000/users/${id}`,
                dataType: "json"
            }).done(function (data) {
            readData()
        })
    }

    $(document).ready(function () {

        readData()

        $('#form-user').submit(function (event) {
            event.preventDefault()
            const id = $('#id').val()
            const string = $('#string').val()
            const integer = $('#integer').val()
            const float = $('#float').val()
            const date = $('#date').val()
            const boolean = $('#boolean').val()
            // console.log(string, integer, float, date, boolean)
            saveData(id, string, integer, float, date, boolean)
        })

        $('table tbody').on('click', '.btn-edit', function(){
            const id = $(this).attr('iddata')
            editData(id)
        })

        $('table tbody').on('click', '.btn-delete', function(){
            const id = $(this).attr('iddatas')
            deleteData(id)
        })


        $('#search-user').submit ( function (event) {
            event.preventDefault()
            const string = $('#strings').val()
            const integer = $('#integers').val()
            const float = $('#s-float').val()
            const startDate = $('#start-date').val()
            const endDate = $('#end-date').val()
            const boolean = $('#s-boolean').val()
            console.log(string, integer, float, startDate, endDate)
            readData({ string, integer, float, startDate, endDate, boolean })
        })

        $('#reset-search').click(function(){
            readData()
            $("#search-user").reset();
        })
        $('#reset-search-add').click(function(){
            readData()
            $("#form-user").reset();
        })
    })

</script>

</html>